<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>åœ°å›¾æ˜¾ç¤º</title>
	<style type="text/css">
		/* åŸºç¡€æ ·å¼é‡ç½® */
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		
		body {
			margin: 0;
			height: 100vh;
			width: 100vw;
			font-family: 'Microsoft YaHei', Arial, sans-serif;
			background-color: #f5f5f5;
		}
		
		#mapContainer {
			height: 100%;
			width: 100%;
			position: relative;
		}
		
		/* æœç´¢æ¡†å®¹å™¨æ ·å¼ */
		#tip {
			position: absolute;
			top: 20px;
			left: 20px;
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			border: none;
			padding: 20px;
			border-radius: 15px;
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
			z-index: 1000;
			min-width: 400px;
			max-width: 500px;
			backdrop-filter: blur(10px);
		}
		
		#tip b {
			color: white;
			font-size: 14px;
			margin-bottom: 10px;
			display: block;
			font-weight: 500;
		}
		
		/* è¾“å…¥æ¡†æ ·å¼ */
		#tip input[type="text"] {
			width: 100%;
			height: 40px;
			border: none;
			padding: 0 15px;
			border-radius: 20px;
			font-size: 14px;
			outline: none;
			background: rgba(255, 255, 255, 0.9);
			transition: all 0.3s ease;
			margin-top: 8px;
		}
		
		#tip input[type="text"]:focus {
			background: white;
			box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
			transform: translateY(-2px);
		}
		
		#tip input[type="text"]::placeholder {
			color: #999;
		}
		
		/* æŒ‰é’®æ ·å¼ */
		#tip input[type="button"] {
			background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
			height: 35px;
			padding: 0 20px;
			text-align: center;
			line-height: 35px;
			color: white;
			font-size: 13px;
			border-radius: 18px;
			outline: none;
			border: none;
			cursor: pointer;
			margin-top: 10px;
			transition: all 0.3s ease;
			font-weight: 500;
		}
		
		#tip input[type="button"]:hover {
			transform: translateY(-2px);
			box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
		}
		
		/* æœç´¢ç»“æœå®¹å™¨ */
		#result1 {
			max-height: 350px;
			overflow-y: auto;
			margin-top: 15px;
			background: rgba(255, 255, 255, 0.95);
			border-radius: 10px;
			backdrop-filter: blur(10px);
		}
		
		/* æœç´¢ç»“æœé¡¹æ ·å¼ */
		#result1 > div {
			padding: 12px 15px !important;
			border-bottom: 1px solid rgba(193, 255, 193, 0.3) !important;
			cursor: pointer;
			transition: all 0.3s ease;
			border-radius: 8px;
			margin: 2px;
		}
		
		#result1 > div:hover {
			background: linear-gradient(45deg, #667eea, #764ba2) !important;
			color: white;
			transform: translateX(5px);
		}
		
		#result1 > div:last-child {
			border-bottom: none !important;
		}
		
		/* æœç´¢ç»“æœè¯¦ç»†ä¿¡æ¯æ ·å¼ */
		#result1 table {
			width: 100%;
			border-collapse: collapse;
		}
		
		#result1 table td {
			padding: 8px;
			vertical-align: top;
		}
		
		#result1 h3 {
			margin: 0 0 8px 0;
			font-size: 14px;
		}
		
		#result1 img {
			border-radius: 50%;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
		}
		
		/* æ»šåŠ¨æ¡ç¾åŒ– */
		#result1::-webkit-scrollbar {
			width: 6px;
		}
		
		#result1::-webkit-scrollbar-track {
			background: rgba(255, 255, 255, 0.1);
			border-radius: 3px;
		}
		
		#result1::-webkit-scrollbar-thumb {
			background: linear-gradient(45deg, #667eea, #764ba2);
			border-radius: 3px;
		}
		
		#result1::-webkit-scrollbar-thumb:hover {
			background: linear-gradient(45deg, #764ba2, #667eea);
		}
		
		/* å“åº”å¼è®¾è®¡ */
		@media (max-width: 768px) {
			#tip {
				left: 10px;
				right: 10px;
				min-width: auto;
				max-width: none;
				padding: 15px;
			}
		}
		
		/* åœ°å›¾æ§ä»¶æ ·å¼ä¼˜åŒ– */
		.amap-toolbar, .amap-maptype-control, .amap-scale-control {
			border-radius: 8px !important;
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1) !important;
		}
		
		/* å°†åœ°å›¾æ§ä»¶ç§»åˆ°å³ä¸‹è§’å¹¶æ”¾å¤§ */
		.amap-toolbar {
			position: fixed !important;
			bottom: 20px !important;
			right: 20px !important;
			top: auto !important;
			left: auto !important;
			transform: scale(1.3) !important;
			transform-origin: bottom right !important;
			background: rgba(255, 255, 255, 0.95) !important;
			backdrop-filter: blur(10px) !important;
		}
		
		/* æ”¾å¤§å·¥å…·æ å†…çš„æ‰€æœ‰æŒ‰é’® */
		.amap-toolbar .amap-btn {
			width: 40px !important;
			height: 40px !important;
			line-height: 40px !important;
			font-size: 18px !important;
		}
		
		/* æ”¾å¤§ç¼©æ”¾æ§ä»¶ */
		.amap-zoom {
			transform: scale(1.3) !important;
			transform-origin: bottom right !important;
		}
		
		.amap-zoom .amap-zoom-in,
		.amap-zoom .amap-zoom-out {
			width: 40px !important;
			height: 40px !important;
			line-height: 40px !important;
			font-size: 20px !important;
			font-weight: bold !important;
		}
		
		/* åœ°å›¾ç±»å‹åˆ‡æ¢æ§ä»¶ä½ç½®è°ƒæ•´ */
		.amap-maptype-control {
			position: fixed !important;
			bottom: 100px !important;
			right: 20px !important;
			top: auto !important;
			left: auto !important;
			transform: scale(1.2) !important;
			transform-origin: bottom right !important;
		}
		
		/* æ¯”ä¾‹å°ºæ§ä»¶ä½ç½®è°ƒæ•´ */
		.amap-scale-control {
			position: fixed !important;
			bottom: 60px !important;
			right: 20px !important;
			top: auto !important;
			left: auto !important;
			transform: scale(1.2) !important;
			transform-origin: bottom right !important;
		}
		
		/* ç¡®ä¿æ§ä»¶ä¸ä¼šé‡å  */
		.amap-toolbar {
			z-index: 999 !important;
		}
		
		.amap-maptype-control {
			z-index: 998 !important;
		}
		
		.amap-scale-control {
			z-index: 997 !important;
		}
		
		/* ç§»åŠ¨ç«¯é€‚é… */
		@media (max-width: 768px) {
			.amap-toolbar {
				transform: scale(1.1) !important;
				bottom: 15px !important;
				right: 15px !important;
			}
			
			.amap-maptype-control {
				transform: scale(1.0) !important;
				bottom: 80px !important;
				right: 15px !important;
			}
			
			.amap-scale-control {
				transform: scale(1.0) !important;
				bottom: 50px !important;
				right: 15px !important;
			}
		}
		
		/* ä¿¡æ¯çª—å£æ ·å¼ */
		.amap-info-window {
			border-radius: 10px !important;
		}
	</style>
</head>
<body>
	<div id="mapContainer"></div>

  <div id="tip">
    <b>ğŸ” è¯·è¾“å…¥æ‚¨è¦æœç´¢çš„åœ°ç‚¹ï¼š</b>
    <input type="text" id="keyword" name="keyword" value="" onkeydown='keydown(event)' placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬å¤§å­¦ã€å¤©å®‰é—¨ã€æ˜Ÿå·´å…‹..." />
    <div id="result1" name="result1"></div>
  </div>

	<script type="text/javascript" src="http://webapi.amap.com/maps?v=1.3&key=330d2ffe4033c945910b51fb4c49ddf7"></script>
	<script type="text/javascript">

			var map = new AMap.Map('mapContainer', {
				resizeEnable: true,
				//rotateEnable: true,
				//dragEnable: true,
				//zoomEnable: true,
				//è®¾ç½®å¯ç¼©æ”¾çš„çº§åˆ«
				//zooms: [3,18],
				//ä¼ å…¥2Dè§†å›¾ï¼Œè®¾ç½®ä¸­å¿ƒç‚¹å’Œç¼©æ”¾çº§åˆ«
				// view: new AMap.View2D({
				// 	center: new AMap.LngLat(116.397428, 39.90923),
				// 	zoom: 12
				// })
			});

      map.plugin(['AMap.ToolBar','AMap.MapType','AMap.Scale'],function(){
        //åœ°å›¾ä¸­æ·»åŠ åœ°å›¾æ“ä½œToolBaræ’ä»¶
        //è®¾ç½®åœ°ä½æ ‡è®°ä¸ºè‡ªå®šä¹‰æ ‡è®°
        var toolBar = new AMap.ToolBar();
        map.addControl(toolBar);

        //æ·»åŠ åœ°å›¾ç±»å‹åˆ‡æ¢æ’ä»¶
        //åœ°å›¾ç±»å‹åˆ‡æ¢
        var mapType= new AMap.MapType({
            defaultType:0,//é»˜è®¤æ˜¾ç¤ºæ™®é€šåœ°å›¾ï¼ˆ0=æ™®é€šåœ°å›¾ï¼Œ1=å«æ˜Ÿåœ°å›¾ï¼‰
            showRoad:true //å åŠ è·¯ç½‘å›¾å±‚
        });
        map.addControl(mapType);

        //åŠ è½½æ¯”ä¾‹å°ºæ’ä»¶
        scale = new AMap.Scale();
        map.addControl(scale);
      });

      addBuildings();
      //å åŠ 3Dæ¥¼å—å›¾å±‚
      function addBuildings() {
        if (document.createElement('canvas').getContext('2d')) {
          //å®ä¾‹åŒ–3Dæ¥¼å—å›¾å±‚
          var buildings = new AMap.Buildings();
          //åœ¨mapä¸­æ·»åŠ 3Dæ¥¼å—å›¾å±‚
          buildings.setMap(map);
        }else{
          document.getElementById("info").innerHTML="å¯¹ä¸èµ·ï¼Œè¿è¡Œè¯¥ç¤ºä¾‹éœ€è¦æµè§ˆå™¨æ”¯æŒHTML5ï¼";
        }
      }


      document.getElementById("keyword").onkeyup = keydown;
      //è¾“å…¥æç¤º
      function autoSearch() {
        var keywords = document.getElementById("keyword").value;
        var auto;
        //åŠ è½½è¾“å…¥æç¤ºæ’ä»¶
            AMap.service(["AMap.Autocomplete"], function() {
            var autoOptions = {
                city: "" //åŸå¸‚ï¼Œé»˜è®¤å…¨å›½
            };
            auto = new AMap.Autocomplete(autoOptions);
            //æŸ¥è¯¢æˆåŠŸæ—¶è¿”å›æŸ¥è¯¢ç»“æœ
            if ( keywords.length > 0) {
                auto.search(keywords, function(status, result){
                  autocomplete_CallBack(result);
                });
            }
            else {
                document.getElementById("result1").style.display = "none";
            }
        });
      }

      //è¾“å‡ºè¾“å…¥æç¤ºç»“æœçš„å›è°ƒå‡½æ•°
      function autocomplete_CallBack(data) {
        var resultStr = "";
        var tipArr = data.tips;
        if (tipArr&&tipArr.length>0) {
            for (var i = 0; i < tipArr.length; i++) {
                resultStr += "<div id='divid" + (i + 1) + "' onmouseover='openMarkerTipById(" + (i + 1)
                            + ",this)' onclick='selectResult(" + i + ")' onmouseout='onmouseout_MarkerStyle(" + (i + 1)
                            + ",this)' style=\"font-size: 13px;cursor:pointer;padding:5px 5px 5px 5px;\"" + "data=" + tipArr[i].adcode + ">" + tipArr[i].name + "<span style='color:#C1C1C1;'>"+ tipArr[i].district + "</span></div>";
            }
        }
        else  {
            resultStr = "<div style='padding: 20px; text-align: center; color: #666;'>" +
                       "<div style='font-size: 24px; margin-bottom: 10px;'>ğŸ¤”</div>" +
                       "<div style='font-size: 14px; line-height: 1.6;'>" +
                       "æŠ±æ­‰ï¼Œæ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç»“æœ<br/>" +
                       "å»ºè®®æ‚¨ï¼š<br/>" +
                       "â€¢ æ£€æŸ¥å…³é”®è¯æ‹¼å†™<br/>" +
                       "â€¢ å°è¯•ä½¿ç”¨æ›´å¸¸è§çš„åœ°å<br/>" +
                       "â€¢ å°è¯•ç¼©çŸ­æœç´¢è¯</div></div>";
        }
        document.getElementById("result1").curSelect = -1;
        document.getElementById("result1").tipArr = tipArr;
        document.getElementById("result1").innerHTML = resultStr;
        document.getElementById("result1").style.display = "block";
      }

      //è¾“å…¥æç¤ºæ¡†é¼ æ ‡æ»‘è¿‡æ—¶çš„æ ·å¼
      function openMarkerTipById(pointid, thiss) {  //æ ¹æ®idæ‰“å¼€æœç´¢ç»“æœç‚¹tip
        thiss.style.background = '#CAE1FF';
      }

      //è¾“å…¥æç¤ºæ¡†é¼ æ ‡ç§»å‡ºæ—¶çš„æ ·å¼
      function onmouseout_MarkerStyle(pointid, thiss) {  //é¼ æ ‡ç§»å¼€åç‚¹æ ·å¼æ¢å¤
        thiss.style.background = "";
      }

      //ä»è¾“å…¥æç¤ºæ¡†ä¸­é€‰æ‹©å…³é”®å­—å¹¶æŸ¥è¯¢
      function selectResult(index) {
        if(index<0){
            return;
        }
        if (navigator.userAgent.indexOf("MSIE") > 0) {
            document.getElementById("keyword").onpropertychange = null;
            document.getElementById("keyword").onfocus = focus_callback;
        }
        //æˆªå–è¾“å…¥æç¤ºçš„å…³é”®å­—éƒ¨åˆ†
        var text = document.getElementById("divid" + (index + 1)).innerHTML.replace(/<[^>].*?>.*<\/[^>].*?>/g,"");
        var cityCode = document.getElementById("divid" + (index + 1)).getAttribute('data');
        document.getElementById("keyword").value = text;
        document.getElementById("result1").style.display = "none";
        //æ ¹æ®é€‰æ‹©çš„è¾“å…¥æç¤ºå…³é”®å­—æŸ¥è¯¢
        map.plugin(["AMap.PlaceSearch"], function() {
            var msearch = new AMap.PlaceSearch();  //æ„é€ åœ°ç‚¹æŸ¥è¯¢ç±»
            AMap.event.addListener(msearch, "complete", placeSearch_CallBack); //æŸ¥è¯¢æˆåŠŸæ—¶çš„å›è°ƒå‡½æ•°
        msearch.setCity(cityCode);
            msearch.search(text);  //å…³é”®å­—æŸ¥è¯¢æŸ¥è¯¢
        });
      }

      //å®šä½é€‰æ‹©è¾“å…¥æç¤ºå…³é”®å­—
      function focus_callback() {
        if (navigator.userAgent.indexOf("MSIE") > 0) {
            document.getElementById("keyword").onpropertychange = autoSearch;
       }
      }

      //è¾“å‡ºå…³é”®å­—æŸ¥è¯¢ç»“æœçš„å›è°ƒå‡½æ•°
      function placeSearch_CallBack(data) {
        //æ¸…ç©ºåœ°å›¾ä¸Šçš„InfoWindowå’ŒMarker
        windowsArr = [];
        marker     = [];
        map.clearMap();
        var resultStr1 = "";
        var poiArr = data.poiList.pois;
        var resultCount = poiArr.length;
        for (var i = 0; i < resultCount; i++) {
            resultStr1 += "<div id='divid" + (i + 1) + "' onmouseover='openMarkerTipById1(" + i + ",this)' onmouseout='onmouseout_MarkerStyle(" + (i + 1) + ",this)' style=\"font-size: 12px;cursor:pointer;padding:0px 0 4px 2px; border-bottom:1px solid #C1FFC1;\"><table><tr><td><img src=\"http://webapi.amap.com/images/" + (i + 1) + ".png\"></td>" + "<td><h3><font color=\"#00a6ac\">åç§°: " + poiArr[i].name + "</font></h3>";
                resultStr1 += TipContents(poiArr[i].type, poiArr[i].address, poiArr[i].tel) + "</td></tr></table></div>";
                addmarker(i, poiArr[i]);
        }
        map.setFitView();
      }

      //é¼ æ ‡æ»‘è¿‡æŸ¥è¯¢ç»“æœæ”¹å˜èƒŒæ™¯æ ·å¼ï¼Œæ ¹æ®idæ‰“å¼€ä¿¡æ¯çª—ä½“
      function openMarkerTipById1(pointid, thiss) {
        thiss.style.background = '#CAE1FF';
        windowsArr[pointid].open(map, marker[pointid]);
      }

      //æ·»åŠ æŸ¥è¯¢ç»“æœçš„marker&infowindow
      function addmarker(i, d) {
        var lngX = d.location.getLng();
        var latY = d.location.getLat();
        var markerOption = {
            map:map,
            icon:"http://webapi.amap.com/images/" + (i + 1) + ".png",
            position:new AMap.LngLat(lngX, latY)
        };
        var mar = new AMap.Marker(markerOption);
        marker.push(new AMap.LngLat(lngX, latY));

        var infoWindow = new AMap.InfoWindow({
            content:"<h3><font color=\"#00a6ac\">  " + (i + 1) + ". " + d.name + "</font></h3>" + TipContents(d.type, d.address, d.tel),
            size:new AMap.Size(300, 0),
            autoMove:true,
            offset:new AMap.Pixel(0,-30)
        });
        windowsArr.push(infoWindow);
        var aa = function (e) {infoWindow.open(map, mar.getPosition());};
        AMap.event.addListener(mar, "mouseover", aa);
      }

      //infowindowæ˜¾ç¤ºå†…å®¹
      function TipContents(type, address, tel) {  //çª—ä½“å†…å®¹
        var str = "  åœ°å€ï¼š" + address||"æš‚æ— " + "<br />  ç”µè¯ï¼š" + tel||"æš‚æ— " + " <br />  ç±»å‹ï¼š" + type||"æš‚æ— ";
        return str;
      }
      function keydown(event){
        var key = (event||window.event).keyCode;
        var result = document.getElementById("result1")
        var cur = result.curSelect;
        if(key===40){//down
            if(cur + 1 < result.childNodes.length){
                if(result.childNodes[cur]){
                    result.childNodes[cur].style.background='';
                }
                result.curSelect=cur+1;
                result.childNodes[cur+1].style.background='#CAE1FF';
                document.getElementById("keyword").value = result.tipArr[cur+1].name;
            }
        }else if(key===38){//up
            if(cur-1>=0){
                if(result.childNodes[cur]){
                    result.childNodes[cur].style.background='';
                }
                result.curSelect=cur-1;
                result.childNodes[cur-1].style.background='#CAE1FF';
                document.getElementById("keyword").value = result.tipArr[cur-1].name;
            }
        }else if(key === 13){
            var res = document.getElementById("result1");
        if(res && res['curSelect'] !== -1){
          selectResult(document.getElementById("result1").curSelect);
        }
        }else{
            autoSearch();
        }
      }

	</script>
</body>
</html>